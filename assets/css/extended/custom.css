/* ================================================================
   1. 基础全局设置 (背景色统一与修复)
   ================================================================ */
:root {
    /* 浅色模式保持你喜欢的设置 */
    --theme: #f6f4f1;
    /* 网页大背景 */
    --card-bg: #f6f4f1;
    /* 矩形框背景 */
    --primary: #1d1e20;
    /* 主文字 */
    --secondary: #57606a;
    /* 次文字 */
    --border: #d0d7de;
    --search-bg: #faf8f2;
    --hover-bg: #f0f0f0;
    /* 白天悬停：比 #fafafa 稍深一点 */
    --tertiary: #0066ccb0;
    --img-bg: #f6f4f1;
    /* 改为纯白 */
    --header-height: 60px;
    /* 定义头部高度变量 */
}

/* 选择器能在你的网页触发夜晚颜色 */
html[data-theme='dark'] {
    --theme: #0d1117;
    /* 大背景 */
    --entry: #161b22;
    /* 卡片背景 */
    --card-bg: #161b22;
    --primary: #e3e3e3;
    --secondary: #bababa;
    --border: #30363d;
    --search-bg: #010409a6;
    --hover-bg: #d1d1d1;
    /* 夜晚悬停：比卡片背景更深，实现你想要的“加深” */
    --tertiary: #58a6ff;
    --img-bg: #f6f4f1;
    /* 夜间模式改为与卡片背景一致，或者用透明 transparent */
}

body.list,
html:has(body.list) {
    /* 核心修改：仅在列表页（Dashboard）禁止整个页面滚动 */
    overflow: hidden !important;
    height: 100vh !important;
}

body,
html {
    background-color: var(--theme) !important;
    /* 修复两侧白边问题 */
}

.main {
    background-color: var(--theme) !important;
    padding-top: calc(var(--header-height) + 20px);
    /* 强行增加 20px 缓冲 */
    box-sizing: border-box;
}

/* Dashboard 模式下的 Main */
.list .main {
    height: 100vh;
    overflow: hidden;
    /* 防止 main 本身滚动 */
    max-width: 100% !important;
    /* 让 Dashboard 占满全屏，贴合侧边 */
    padding: 20px 0;
    /* 减少左右内边距 */
    padding-top: calc(var(--header-height) + 15px) !important;
}

/* 强制头部固定 */
.nav {
    position: fixed !important;
    top: 0;
    left: 0;
    right: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    /* 提高 z-index 确保要在最上层 */
    background: var(--theme);
    /* 确保头部不透明 */
    height: var(--header-height);
    display: flex;
    flex-wrap: nowrap;
    /* 禁止导航栏换行 */
    align-items: center;
    border-bottom: 1px solid var(--border);
    /* 可选：增加一条底线分隔 */
    padding: 0 20px;
    /* 增加内边距 */
    white-space: nowrap;
    /* 防止内容内部换行 */
}


/* ================================================================
   2. 首页三栏布局 (仪表盘感：分离与间距)
   ================================================================ */
/* 首页主容器放宽 */
.list .main {
    max-width: 1600px !important;
    /* 稍微再宽一点适应固定布局 */
    margin: 0 auto !important;
    padding: 20px 10px;
    padding-top: calc(var(--header-height) + 15px) !important;
}

/* 三栏布局：容器填满高度 */
.column-container {
    display: flex !important;
    flex-direction: row;
    justify-content: center;
    align-items: flex-start;
    gap: 20px;
    width: 100%;
    height: 100%;
    /* 填满 .main 的剩余部分 */
    overflow: hidden;
    /* 自身不滚动 */
    padding-top: 10px;
    /* 增加顶部间距，防止侧边栏被遮挡 */
}

/* 左右侧边栏：固定不动，如果内容过多可自身滚动 */
.sidebar-left,
.sidebar-right {
    width: 280px !important;
    flex-shrink: 0;
    height: 100%;
    /* 填满高度 */
    overflow-y: auto;
    /* 允许侧边栏内部滚动 */
    padding-bottom: 40px;
    /* 底部留白 */
    display: flex;
    flex-direction: column;
    gap: 25px;

    /* 隐藏侧边栏滚动条但保留功能 (Chrome/Safari) */
    scrollbar-width: none;
    /* Firefox */
    -ms-overflow-style: none;
    /* IE/Edge */
}

.sidebar-left::-webkit-scrollbar,
.sidebar-right::-webkit-scrollbar {
    display: none;
}


/* 中间主内容区：核心修改 - 只有该区域滚动 */
.main-content {
    flex: 1;
    min-width: 0;
    height: 100%;
    /* 填满高度 */
    overflow-y: scroll;
    /* 强制开启滚动 */
    padding-right: 15px;
    /* 防止滚动条盖住内容 */
    padding-bottom: 20px;
    /* 底部留白，方便看到最后 */

    scrollbar-width: none;
    display: flex;
    flex-direction: column;
    gap: 10px;
    /* Increased gap between cards */
}

/* 响应式 */
@media screen and (max-width: 1100px) {

    body.list,
    html:has(body.list),
    body,
    html {
        overflow: auto !important;
        /* 移动端恢复默认滚动行为，体验更好 */
        height: auto !important;
    }

    /* 必须同时解锁 .list .main 这个高权重选择器 */
    .list .main {
        height: auto !important;
        overflow: visible !important;
    }

    .main {
        height: auto;
        overflow: visible;
    }

    .nav {
        position: sticky !important;
        /* 移动端用 sticky 比较自然 */
    }

    .column-container {
        flex-direction: column !important;
        height: auto;
        overflow: visible;
    }

    .sidebar-left,
    .sidebar-right,
    .main-content {
        width: 100% !important;
        height: auto !important;
        overflow: visible !important;
    }
}

/* ================================================================
   3. 矩形框卡片样式 (Separated Boxes)
   ================================================================ */
.card,
.post-entry.card {
    background: var(--card-bg) !important;
    color: var(--primary) !important;
    border: 1px solid var(--border) !important;
    border-radius: 16px !important;
    padding: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08) !important;
    /* box-shadow: none !important; */
    transition:
        background-color 0.3s ease,
        color 0.3s ease,
        border-color 0.3s ease,
        transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
        box-shadow 0.3s ease;
}

/* 深色模式矩形背景设置 */
html[data-theme='dark'] .card,
html[data-theme='dark'] .post-entry.card {
    background: var(--entry) !important;
    box-shadow: none;
}

/* 确保所有文字颜色跟随变量 */
.card h3,
.card h4,
.card a,
.card p,
.card li,
.stats p,
.stats span {
    color: var(--primary) !important;
}

.stats p span,
.tag-list a span {
    color: var(--secondary) !important;
}

/* 文章预览卡片特殊处理 */
.post-entry.card {
    padding: 0 !important;
    overflow: hidden;
    flex-shrink: 0 !important;
    /* 关键：禁止卡片在垂直方向被挤压 */
}

.post-entry .entry-header,
.post-entry .entry-content,
.post-entry .entry-footer {
    padding-left: 20px;
    /* 缩小内边距 */
    padding-right: 20px;
}

.post-entry .entry-header {
    margin-top: 8px !important;
    display: block !important;
    flex-shrink: 0 !important;
    /* Prevent header compression */
}

/* 恢复被误删的文字内容样式 */
.post-entry .entry-content {
    display: -webkit-box !important;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden !important;
    visibility: visible !important;
    opacity: 1 !important;
    text-overflow: ellipsis;
    margin-bottom: 12px;
    flex-grow: 1 !important;
    /* 填充剩余空间 */
    flex-shrink: 1 !important;
}


/* ================================================================
   4. 图片样式模块
   ================================================================ */
/* 1. 统一图片容器设置 */
.entry-cover,
.post-single .entry-cover {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    background-color: var(--img-bg) !important;
    /* 使用独立的暖灰色变量 */
    transition: background-color 0.3s ease;
    /* 只有背景色参与过渡 */
}

/* 首页预览图高度与边距 */
.entry-cover {
    width: 100%;
    height: 180px !important;
    /* 适当增加高度 */
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    overflow: hidden !important;
    margin: 0;
    border-radius: 12px 12px 0 0;
    transition: background-color 0.2s ease-in-out !important;
}

/* 详情页顶部图高度 */
.post-single .entry-cover {
    width: 100%;
    height: 300px !important;
    /* 设置一个固定高度防止无限放大 */
    margin-bottom: 25px;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* 2. 图片本体显示规则 */
.entry-cover img,
.post-single .entry-cover img {
    /* 核心修改：不再强制 100%，而是限制最大尺寸 */
    width: auto !important;
    height: auto !important;
    max-width: 100% !important;
    max-height: 100% !important;
    object-fit: contain !important;
    /* 绝对保证不裁剪 */
    mix-blend-mode: normal !important;
    filter: brightness(1);
    /* 保持原亮度，确保白色是纯白 (#ffffff) */
}

/* 3. 夜晚模式下的图片滤镜 */
html[data-theme='dark'] .entry-cover img,
html[data-theme='dark'] .post-single .post-content img {
    filter: brightness(0.92) contrast(1.1) !important;
}

/* 4. 详情页正文图片额外处理 */
.post-single .post-content img {
    max-height: 500px !important;
    max-width: 100% !important;
    width: auto !important;
    height: auto !important;
    margin: 20px auto;
    display: block;
    border-radius: 8px;
    object-fit: contain !important;
    padding: 10px;
    background-color: var(--img-bg) !important;
    /* 正文图片也应用暖灰色底 */
}

/* 5. 交互效果 */
.post-entry.card:hover .entry-cover img {
    transform: scale(1.03);
}

/* ================================================================
    5. 搜索框增强 (让它变明显) 
    =============================================================*/
.home-search {
    margin: 10px auto;
    padding: 0 10px;
    max-width: 600px;
    flex: 1;
    /* 允许搜索框在导航栏中自动伸缩 */
    min-width: 100px;
    /* 允许压缩到最小 */
}

.home-search form {
    background: var(--search-bg) !important;
    width: 100%;
    /* 使用专门的搜索框背景 */
    border: 1px solid var(--border) !important;
    height: 40px;
    border-radius: 18px;
    /* 圆角*/
    padding: 0px 15px;
    /* 左右内边距；上下0，配合input的padding控顶部间距 */
    box-sizing: border-box;
    /* 关键：让边框/内边距包含在height内，不溢出 */
    display: flex;
    /* 弹性布局，让input和button横向排列，避免错位 */
    align-items: center;
    /* 垂直居中，解决顶部过近的核心 */
    transition: all 0.3s ease;
    overflow: hidden;
    /* 确保内部元素不溢出圆角 */
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
}

.home-search input {
    color: var(--primary) !important;
    flex: 1;
    /* 让输入框占据剩余空间 */
    width: 100%;
    /* 确保填满 */
}

.home-search form:focus-within {
    background: var(--card-bg) !important;
    box-shadow: 0 0 0 3px rgba(0, 100, 255, 0.1);
    border-color: var(--tertiary) !important;
}

.home-search input::placeholder {
    color: var(--secondary);
}

.home-search button {
    color: var(--secondary) !important;
}

/* 搜索框聚焦时，边框高亮 */
.home-search form:focus-within {
    background: var(--card-bg) !important;
    /* 聚焦时稍微亮一点 */
}

/* ================================================================
   6. 其他细节微调
   ================================================================ */
/* 头像圆形 */
.profile-card .avatar {
    width: 120px !important;
    height: 120px !important;
    border-radius: 50% !important;
    border: 4px solid var(--theme);
    margin-bottom: 20px;
}

/* 导航栏对齐 */
.nav {
    max-width: 1300px;
    margin: 0 auto;
}


/* 链接悬停 */
.social-links a {
    position: relative;
    text-decoration: none !important;
}

.social-links a::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: 0;
    left: 0;
    background-color: var(--secondary);
    transition: width 0.3s ease;
}

.social-links a:hover::after {
    width: 100%;
    /* 鼠标移上去，下划线从左向右长出来 */
}

.tag-list li {
    list-style: none;
    margin: 5px 0;
}

/* 分类标签列表悬停 */
.tag-list li a {
    padding: 2px 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

/* 归档年份小按钮悬停 */
.year-link {
    padding: 2px 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: inline-flex !important;
    border: 1px solid transparent;
    margin: 0 1px;
    /* 加间距，可选 */
}


/* 最新文章列表悬停 */
.recent-card ul li {
    list-style: none;
    margin: 5px 0;
}

.recent-card ul li a {
    display: block;
    /* 让整行都可以点击和变色 */
    padding: 2px 8px;
    /* 控制变色区域的大小 */
    border-radius: 8px;
    /* 圆角矩形 */
    transition: all 0.3s ease;
    border: 1px solid transparent;
    /* 预留边框位置，防止闪烁 */
}


/* 悬停效果：实现你要求的背景加深逻辑 */
.tag-list li a:hover,
.year-link:hover,
.recent-card ul li a:hover {
    background: var(--hover-bg) !important;
    transform: translateX(4px);
    color: var(--tertiary) !important;
    border-color: var(--border) !important;
}

/* 文章预览卡片整体悬停 */
.post-entry.card {
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.post-entry.card:hover {
    transform: translateY(-2px);
    /* 整个卡片上移 */
    border-color: var(--tertiary);
    /* 边框变色 */
}

/* ================================================================
   7. 滚动条修复
   ================================================================ */
::-webkit-scrollbar-thumb {
    background: var(--border) !important;
    /* 强制设为边框灰色，不随蓝色变量变色 */
}

::-webkit-scrollbar-thumb:hover {
    background: var(--secondary) !important;
}

/* ================================================================
   8. 学习笔记页网格化
   ================================================================ */
/* 强制首页容器不准开启网格 */
body.is-home .main {
    display: block !important;
    grid-template-columns: none !important;
    max-width: 1300px !important;

}

/* 确保首页的三栏 flex 布局不受影响 */
/* 移除强制 Row 的规则，让 Media Query 生效 */
body.is-home .column-container {
    display: flex !important;
}

/* 利用 is-list-page 身份证，精准开启瀑布流布局 (Masonry) */
body.is-list-page .main {
    display: block !important;
    /* 禁用 Grid/Flex，使用 Block 配合 Columns */
    /* column-count: 2 !important;  <-- MOVED TO WRAPPER via JS/HTML change */
    /* column-gap: 20px !important; <-- MOVED TO WRAPPER */
    max-width: 1300px !important;
    margin: 0 auto !important;

    padding: 10px !important;
    padding-top: calc(var(--header-height)) !important;

    height: 100vh !important;
    /* 必须有高度才能滚动 */
    overflow-y: scroll !important;
    scrollbar-width: none;
    /* 隐藏滚动条但允许滚动 */
}

/* New Wrapper for Masonry Columns */
body.is-list-page .posts-wrapper {
    column-count: 2 !important;
    column-gap: 20px !important;
    width: 100%;
}

/* 让筛选栏横跨瀑布流布局 */
body.is-list-page .filter-controls {
    column-span: all !important;
    -webkit-column-span: all !important;
    display: flex;
    margin-bottom: 20px;
    width: 100%;

    /* Visual Separation from top */
    margin-top: 10px !important;
    padding-top: 10px !important;
}

/* 列表页标题 (Posts) 横跨三列 */
body.is-list-page .main>header,
body.is-list-page .main>h1 {
    display: none !important;
}

/* 列表页卡片适配瀑布流 */
body.is-list-page .post-entry {
    height: auto !important;
    display: inline-block !important;
    /* 关键：防止跨列断裂 */
    width: 100% !important;
    margin-bottom: 20px !important;
    /* 卡片垂直间距 */
    break-inside: avoid !important;
    /* 禁止卡片内部断裂 */
    page-break-inside: avoid !important;
    -webkit-column-break-inside: avoid !important;
    background: var(--card-bg);
    /* 确保背景色，防止透明 */
    min-height: auto !important;
    /* 取消强制高度，让内容决定高度 */
    background: transparent !important;
    border: 1px solid var(--border) !important;
    /* 给个细边框，圆角边缘更清晰 */
    border-radius: 12px !important;
    overflow: hidden !important;
    position: relative;
}

body.is-list-page .post-entry.card .entry-link {
    border-radius: inherit !important;
}

/* 给图片一个固定的暖灰色底色 */
body.entry-cover,
.post-single .entry-cover {
    margin: 0 !important;
    /* 移除 margin 以便让图片贴合卡片顶部圆角 */
    background-color: var(--img-bg) !important;
    border-radius: 0 !important;
    /* 让父级 .card 的 overflow:hidden 来决定圆角 */
    border-bottom: 1px solid var(--border);
    /* 如果想区分图片和文字，加条底线 */
}

body.is-list-page .post-entry .entry-cover img,
body.is-list-page .post-entry.card .entry-cover img {
    border-radius: 0 !important;
    max-height: none !important;
    /* 允许自适应 */
    width: 100% !important;
    height: 180px !important;
    object-fit: contain !important;
    /* 完整显示，不裁剪 */
    /* 依靠父级剪裁 */
}

/* 自适应图片，移除强制高度 */
body.is-list-page .post-entry .entry-cover {
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
    overflow: visible !important;
}

@media screen and (max-width: 1100px) {
    body.is-list-page .main {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

@media screen and (max-width: 750px) {
    body.is-list-page .main {
        grid-template-columns: 1fr !important;
    }
}